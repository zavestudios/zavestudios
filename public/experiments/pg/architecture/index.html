<!DOCTYPE html>
<html id="R-html" lang="en-us" dir="ltr" itemscope itemtype="http://schema.org/Article" data-r-output-format="html">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <meta name="generator" content="Hugo 0.154.5">
    <meta name="generator" content="Relearn 9.0.3+dd4f8457f5143e91eae3954813494d2b0cc6741c">
    <meta name="robots" content="noindex, nofollow, noarchive, noimageindex">
    <meta name="description" content="Multi-Tenant PostgreSQL Architecture Overview This document describes a multi-tenant PostgreSQL architecture designed to support multiple tenants on a single database server (for example, a single AWS RDS PostgreSQL instance) while preserving strong isolation between tenants.
The primary goal is to reduce infrastructure cost (fewer RDS instances) without compromising tenant data isolation or complicating accreditation in sensitive environments (e.g., DoD AWS).">
    <meta name="author" content="">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:description" content="Multi-Tenant PostgreSQL Architecture Overview This document describes a multi-tenant PostgreSQL architecture designed to support multiple tenants on a single database server (for example, a single AWS RDS PostgreSQL instance) while preserving strong isolation between tenants.
The primary goal is to reduce infrastructure cost (fewer RDS instances) without compromising tenant data isolation or complicating accreditation in sensitive environments (e.g., DoD AWS).">
    <meta property="og:url" content="http://localhost:1313/experiments/pg/architecture/index.html">
    <meta property="og:site_name" content="ZaveStudios">
    <meta property="og:description" content="Multi-Tenant PostgreSQL Architecture Overview This document describes a multi-tenant PostgreSQL architecture designed to support multiple tenants on a single database server (for example, a single AWS RDS PostgreSQL instance) while preserving strong isolation between tenants.
The primary goal is to reduce infrastructure cost (fewer RDS instances) without compromising tenant data isolation or complicating accreditation in sensitive environments (e.g., DoD AWS).">
    <meta property="og:locale" content="en_us">
    <meta property="og:type" content="article">
    <meta property="article:section" content="Experiments">
    <meta itemprop="description" content="Multi-Tenant PostgreSQL Architecture Overview This document describes a multi-tenant PostgreSQL architecture designed to support multiple tenants on a single database server (for example, a single AWS RDS PostgreSQL instance) while preserving strong isolation between tenants.
The primary goal is to reduce infrastructure cost (fewer RDS instances) without compromising tenant data isolation or complicating accreditation in sensitive environments (e.g., DoD AWS).">
    <meta itemprop="wordCount" content="453">
    <title></title>
    <link href="/images/logo.png?1770157528" rel="icon" type="image/png">
    <link href="/css/auto-complete/auto-complete.min.css?1770157528" rel="stylesheet">
    <script src="/js/auto-complete/auto-complete.min.js?1770157528" defer></script>
    <script src="/js/search-lunr.js?1770157528" defer></script>
    <script src="/js/search.js?1770157528" defer></script>
    <script>
      window.relearn = window.relearn || {};
      window.relearn.index_js_url="/searchindex.en.js?1770157528";
    </script>
    <script src="/js/lunr/lunr.min.js?1770157528" defer></script>
    <script src="/js/lunr/lunr.stemmer.support.min.js?1770157528" defer></script>
    <script src="/js/lunr/lunr.multi.min.js?1770157528" defer></script>
    <script src="/js/lunr/lunr.en.min.js?1770157528" defer></script>
    <script>
      window.relearn = window.relearn || {};
      window.relearn.contentLangs=['en'];
    </script>
    <link href="/fonts/fontawesome/css/all.min.css?1770157528" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/fonts/fontawesome/css/all.min.css?1770157528" rel="stylesheet"></noscript>
    <link href="/css/perfect-scrollbar/perfect-scrollbar.min.css?1770157528" rel="stylesheet">
    <link href="/css/theme.css?1770157528" rel="stylesheet">
    <link href="/css/format-html.css?1770157528" rel="stylesheet" id="R-format-style">
    <script>
      window.relearn = window.relearn || {};
      // configuration
      window.relearn.min = ``;
      window.relearn.path='\/experiments\/pg\/architecture\/index.html';
      window.relearn.relBasePath='..\/..\/..';
      window.relearn.relBaseUri='..\/..\/..';
      window.relearn.absBaseUri='http:\/\/localhost:1313';
      window.relearn.disableInlineCopyToClipboard=false;
      window.relearn.enableBlockCodeWrap=true;
      // translations
      window.T_Copy_to_clipboard = `Copy text to clipboard`;
      window.T_Copied_to_clipboard = `Text copied to clipboard!`;
      window.T_Link_copied_to_clipboard = `Link copied to clipboard!`;
      window.T_Reset_view = `Reset view`;
      window.T_View_reset = `View reset!`;
      window.T_No_results_found = `No results found for "{0}"`;
      window.T_N_results_found = `{1} results found for "{0}"`;
      window.T_Browser_unsupported_feature = `This browser doesn't support this feature`;
      // variant stuff
      window.relearn.themevariants = [ 'auto' ];
      window.relearn.customvariantprefix = "my-custom-";
      window.relearn.changeVariant = function(variant) {
        var oldVariant = document.documentElement.dataset.rThemeVariant;
        window.localStorage.setItem(window.relearn.absBaseUri + "/variant", variant);
        document.documentElement.dataset.rThemeVariant = variant;
        if (oldVariant != variant) {
          document.dispatchEvent( new CustomEvent('themeVariantLoaded', { detail: { variant, oldVariant } }) );
          window.relearn.markVariant();
        }
      }
      window.relearn.markVariant = function() {
        var variant = window.localStorage.getItem(window.relearn.absBaseUri + "/variant");
        document.querySelectorAll(".R-variantswitcher select").forEach((select) => {select.value = variant;});
      }
      window.relearn.initVariant = function() {
        var variant = window.localStorage.getItem(window.relearn.absBaseUri + "/variant") ?? "";
        if( !variant ||
            (!variant.startsWith(window.relearn.customvariantprefix) && !window.relearn.themevariants.includes(variant)) ||
            (variant.startsWith(window.relearn.customvariantprefix) && !window.localStorage.getItem(window.relearn.absBaseUri + "/variantstylesheet-" + variant)) ){
          variant = window.relearn.themevariants[0];
          window.localStorage.setItem(window.relearn.absBaseUri + "/variant", variant);
        }
        document.documentElement.dataset.rThemeVariant = variant;
      }
      window.relearn.initVariant();
      window.relearn.markVariant();
    </script>
  </head>
  <body class="mobile-support html" data-origin="/experiments/pg/architecture/index.html">
    <div id="R-body" class="default-animation">
      <div id="R-body-overlay"></div>
      <nav id="R-topbar" class="default-animation">
        <div class="topbar-wrapper default-animation">
          <div class="topbar-sidebar-divider default-animation"></div>
          <div class="topbar-area topbar-area-start" data-area="start">
            <div class="topbar-button topbar-button-sidebar default-animation" data-content-empty="disable" data-width-s="show" data-width-m="hide" data-width-l="hide">
<span class="btn cstyle button link noborder notitle interactive"><button onclick="toggleNav()" type="button" title="Menu (CTRL&#43;ALT&#43;n)"><i class="fa-fw fas fa-bars"></i></button></span>
            </div>
            <div class="topbar-button topbar-button-toc default-animation" data-content-empty="hide" data-width-s="show" data-width-m="show" data-width-l="show">
<span class="btn cstyle button link noborder notitle interactive"><button onclick="toggleTopbarFlyout(this)" type="button" title="Table of Contents (CTRL&#43;ALT&#43;t)"><i class="fa-fw fas fa-table-list"></i></button></span>
              <div class="topbar-content">
                <div class="topbar-content-wrapper">
<nav class="TableOfContents">
  <ul>
    <li><a href="#overview">Overview</a></li>
    <li><a href="#high-level-design">High-Level Design</a></li>
    <li><a href="#logical-model">Logical Model</a>
      <ul>
        <li><a href="#architecture-diagram">Architecture Diagram</a></li>
      </ul>
    </li>
    <li><a href="#example-mapping-local-docker-to-aws-rds">Example Mapping: Local Docker to AWS RDS</a></li>
    <li><a href="#data-isolation-summary">Data Isolation Summary</a></li>
  </ul>
</nav>
                </div>
              </div>
            </div>
          </div>
          <ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype="http://schema.org/BreadcrumbList"><li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement" class=""><a itemprop="item" href="/index.html"><span itemprop="name">ZaveStudios</span></a><meta itemprop="position" content="1">&nbsp;>&nbsp;</li><li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement" class=""><a itemprop="item" href="/experiments/index.html"><span itemprop="name">Experiments</span></a><meta itemprop="position" content="2">&nbsp;>&nbsp;</li>
          </ol>
          <div class="topbar-area topbar-area-end" data-area="end">
            <div class="topbar-button topbar-button-prev default-animation" data-content-empty="disable" data-width-s="show" data-width-m="show" data-width-l="show">
<span class="btn cstyle button link noborder notitle interactive"><a href="/experiments/index.html" title="Experiments (ðŸ¡)"><i class="fa-fw fas fa-chevron-left"></i></a></span>
            </div>
            <div class="topbar-button topbar-button-next default-animation" data-content-empty="disable" data-width-s="show" data-width-m="show" data-width-l="show">
<span class="btn cstyle button link noborder notitle interactive"><a href="/infra/index.html" title="Infrastructure (ðŸ¡’)"><i class="fa-fw fas fa-chevron-right"></i></a></span>
            </div>
            <div class="topbar-button topbar-button-more default-animation" data-content-empty="hide" data-width-s="show" data-width-m="show" data-width-l="show">
<span class="btn cstyle button link noborder notitle interactive"><button onclick="toggleTopbarFlyout(this)" type="button" title="More"><i class="fa-fw fas fa-ellipsis-v"></i></button></span>
              <div class="topbar-content">
                <div class="topbar-content-wrapper">
                  <div class="topbar-area topbar-area-more" data-area="more">
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </nav>
      <div id="R-main-overlay"></div>
      <main id="R-body-inner" class="highlightable experiments" tabindex="-1">
        <div class="flex-block-wrapper">
<article class="default">
  <header class="headline">
  </header>

<h1 id=""></h1>

<h1 id="multi-tenant-postgresql-architecture">Multi-Tenant PostgreSQL Architecture<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type="button" title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h1>
<h2 id="overview">Overview<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type="button" title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2>
<p>This document describes a multi-tenant PostgreSQL architecture designed to support multiple tenants on a single database server (for example, a single AWS RDS PostgreSQL instance) while preserving strong isolation between tenants.</p>
<p>The primary goal is to reduce infrastructure cost (fewer RDS instances) without compromising tenant data isolation or complicating accreditation in sensitive environments (e.g., DoD AWS).</p>
<h2 id="high-level-design">High-Level Design<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type="button" title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2>
<p>Key design points:</p>
<ul>
<li>One PostgreSQL <strong>server (cluster)</strong> per environment (e.g., per IL2/IL4 environment).</li>
<li>One <strong>database per tenant</strong>:
<ul>
<li><code>db_tenant_a</code></li>
<li><code>db_tenant_b</code></li>
<li><code>db_tenant_c</code></li>
</ul>
</li>
<li>One <strong>login role per tenant application</strong>:
<ul>
<li><code>tenant_a_app</code></li>
<li><code>tenant_b_app</code></li>
<li><code>tenant_c_app</code></li>
</ul>
</li>
<li>One <strong>dedicated schema per tenant database</strong>:
<ul>
<li><code>db_tenant_a.app</code></li>
<li><code>db_tenant_b.app</code></li>
<li><code>db_tenant_c.app</code></li>
</ul>
</li>
<li>The default <code>public</code> schema is <strong>not used</strong> for tenant data and is locked down.</li>
<li>Tenants have:
<ul>
<li><code>CONNECT</code> only to their own database.</li>
<li><code>USAGE</code> and <code>CREATE</code> only in their own schema.</li>
</ul>
</li>
<li>No cross-database extensions (e.g., <code>dblink</code>, <code>postgres_fdw</code>) are enabled for tenant roles.</li>
</ul>
<h2 id="logical-model">Logical Model<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type="button" title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2>
<p>Per tenant:</p>
<ul>
<li><strong>Database</strong>: logical boundary for data and privileges (<code>db_tenant_a</code>)</li>
<li><strong>Schema</strong>: namespace for tenant objects (<code>app</code>)</li>
<li><strong>Role</strong>: used by the tenantâ€™s application (<code>tenant_a_app</code>)</li>
</ul>
<p>Relationships:</p>
<ul>
<li>One application role per tenant database.</li>
<li>The role owns or is granted access to the tenantâ€™s <code>app</code> schema.</li>
<li>No tenant role has permissions on another tenantâ€™s database or schema.</li>
</ul>
<h3 id="architecture-diagram">Architecture Diagram<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type="button" title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3>
<pre class="mermaid actionbar-wrapper align-center ">flowchart TD

    subgraph Instance[PostgreSQL Instance]
        A[db_tenant_a]
        B[db_tenant_b]
        C[db_tenant_c]
    end

    subgraph Schemas
        SA[db_tenant_a.app]
        SB[db_tenant_b.app]
        SC[db_tenant_c.app]
    end

    subgraph Roles
        RA[tenant_a_app&lt;br/&gt;LOGIN ROLE]
        RB[tenant_b_app&lt;br/&gt;LOGIN ROLE]
        RC[tenant_c_app&lt;br/&gt;LOGIN ROLE]
        RO[platform_owner&lt;br/&gt;NOLOGIN ROLE]
    end

    %% Ownership
    RO --&gt; SA
    RO --&gt; SB
    RO --&gt; SC

    %% Grant model
    RA --&gt;|USAGE + CRUD| SA
    RB --&gt;|USAGE + CRUD| SB
    RC --&gt;|USAGE + CRUD| SC

    %% Isolation boundaries
    RA -..-&gt;|NO ACCESS| SB
    RA -..-&gt;|NO ACCESS| SC
    RB -..-&gt;|NO ACCESS| SA
    RB -..-&gt;|NO ACCESS| SC
    RC -..-&gt;|NO ACCESS| SA
    RC -..-&gt;|NO ACCESS| SB</pre>
<h2 id="example-mapping-local-docker-to-aws-rds">Example Mapping: Local Docker to AWS RDS<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type="button" title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2>
<p>Local development:</p>
<ul>
<li><code>docker-compose.yml</code> starts a single PostgreSQL container.</li>
<li><code>init/01_init_tenants.sql</code>:
<ul>
<li>creates tenant databases and roles,</li>
<li>configures basic privileges,</li>
<li>creates sample tables for testing.</li>
</ul>
</li>
<li><code>scripts/test_isolation.sh</code>:
<ul>
<li>verifies databases, schemas, and row-level access.</li>
</ul>
</li>
</ul>
<p>AWS deployment (future, via Terraform):</p>
<ul>
<li>An AWS RDS PostgreSQL instance replaces the local container.</li>
<li>A Terraform <code>postgresql</code> provider manages:
<ul>
<li>databases (<code>postgresql_database</code>)</li>
<li>roles (<code>postgresql_role</code>)</li>
<li>schemas (<code>postgresql_schema</code>)</li>
<li>grants (<code>postgresql_grant</code>)</li>
</ul>
</li>
<li>The same logical design is applied to RDS using infrastructure-as-code rather than init scripts.</li>
</ul>
<h2 id="data-isolation-summary">Data Isolation Summary<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type="button" title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2>
<p>Data isolation is achieved through:</p>
<ul>
<li><strong>Database-level isolation</strong>:
<ul>
<li><code>REVOKE CONNECT</code> on tenant databases from <code>PUBLIC</code>.</li>
<li><code>GRANT CONNECT</code> only to the tenantâ€™s application role.</li>
</ul>
</li>
<li><strong>Schema-level isolation</strong>:
<ul>
<li>Only the tenantâ€™s role has <code>USAGE</code> and <code>CREATE</code> in its <code>app</code> schema.</li>
<li><code>public</code> is not used for tenant tables and can be fully locked down.</li>
</ul>
</li>
<li><strong>No cross-DB bridges</strong>:
<ul>
<li>Cross-database extensions are not created for tenant roles.</li>
<li>Only admin roles can create extensions, and those are tightly controlled.</li>
</ul>
</li>
</ul>
<p>This allows many tenants to share a single PostgreSQL server while maintaining strong boundaries and reducing the number of RDS instances required.</p>

  <footer class="footline">
  </footer>
</article>
        </div>
      </main>
    </div>
    <aside id="R-sidebar" class="default-animation">
      <div id="R-header-topbar" class="default-animation"></div>
      <div id="R-header-wrapper" class="default-animation">
        <a id="R-logo" class="R-default direction-row" href="/index.html">
          <span class="logo-title default-animation">ZaveStudios</span>
        </a>
        <search><form action="/search/index.html" method="get">
          <div class="searchbox default-animation">
            <button class="search-detail" type="submit" title="Search (CTRL+ALT+f)"><i class="fas fa-fw fa-search"></i></button>
            <label class="a11y-only" for="R-search-by">Search</label>
            <input data-search-input id="R-search-by" name="search-by" class="search-by" type="search" placeholder="Search...">
            <button class="search-clear" type="button" data-search-clear="" title="Clear search"><i class="fas fa-fw fa-times" title="Clear search"></i></button>
          </div>
        </form></search>
      </div>
      <div id="R-homelinks" class="default-animation homelinks">
        <div class="R-menu-divider default-animation">
          <hr class="padding default-animation">
        </div>
        <div class="R-sidebarmenu R-shortcutmenu-homelinks default-animation">
          <ul class="space collapsible-menu">
            <li class="" data-nav-id="/index.html"><a class="padding" href="/index.html"><i class="fa-fw fas fa-home"></i> Home</a></li>
          </ul>
        </div>
        <div class="R-menu-divider default-animation">
          <hr class="padding default-animation">
        </div>
        <div class="R-sidebarmenu R-shortcutmenu-headercontrols default-animation">
          <ul class="">
          </ul>
        </div>
        <div class="R-menu-divider default-animation">
          <hr class="padding default-animation">
        </div>
      </div>
      <div id="R-content-wrapper" class="highlightable">
        <div class="R-sidebarmenu R-shortcutmenu-main default-animation">
          <ul class="enlarge morespace collapsible-menu">
            <li class="" data-nav-id="/adrs/index.html"><a class="padding default-animation" href="/adrs/index.html">Architecture Decision Records</a><ul id="R-subsections-dbdc3721419d814fe87aa505dc6cf5c9" class="collapsible-menu"></ul></li>
            <li class="" data-nav-id="/ci-cd/index.html"><a class="padding default-animation" href="/ci-cd/index.html">CI/CD</a><ul id="R-subsections-23feba4145c0fd739cb117965ba11416" class="collapsible-menu"></ul></li>
            <li class="parent " data-nav-id="/experiments/index.html"><a class="padding default-animation" href="/experiments/index.html">Experiments</a><ul id="R-subsections-fc581a3813c1f5f183d87c299445898b" class="collapsible-menu">
            <li class="active hidden " data-nav-id="/experiments/pg/architecture/index.html"><a class="padding" href="/experiments/pg/architecture/index.html"></a></li></ul></li>
            <li class="" data-nav-id="/infra/index.html"><a class="padding" href="/infra/index.html">Infrastructure</a></li>
            <li class="" data-nav-id="/tenants/index.html"><a class="padding default-animation" href="/tenants/index.html">Tenants</a><ul id="R-subsections-c9e772ccc978a183b81aaafd0378f4ea" class="collapsible-menu"></ul></li>
          </ul>
        </div>
        <div class="R-sidebarmenu R-shortcutmenu-shortcuts default-animation">
          <ul class="space collapsible-menu">
          </ul>
        </div>
        <div id="R-footer-margin" class="default-animation"></div>
        <div class="R-menu-divider default-animation">
          <hr class="padding default-animation">
        </div>
        <div class="R-sidebarmenu R-shortcutmenu-footercontrols default-animation">
          <ul class="">
          </ul>
        </div>
<div id="R-footer" class="default-animation"><p>Built with <a href="https://github.com/McShelby/hugo-theme-relearn" title="love"><i class="fas fa-heart"></i></a> by <a href="https://gohugo.io/">Hugo</a></p></div>
      </div>
    </aside>
    <script src="/js/js-yaml/js-yaml.min.js?1770157528" defer></script>
    <script src="/js/d3/d3-color.min.js?1770157528" defer></script>
    <script src="/js/d3/d3-dispatch.min.js?1770157528" defer></script>
    <script src="/js/d3/d3-drag.min.js?1770157528" defer></script>
    <script src="/js/d3/d3-ease.min.js?1770157528" defer></script>
    <script src="/js/d3/d3-interpolate.min.js?1770157528" defer></script>
    <script src="/js/d3/d3-selection.min.js?1770157528" defer></script>
    <script src="/js/d3/d3-timer.min.js?1770157528" defer></script>
    <script src="/js/d3/d3-transition.min.js?1770157528" defer></script>
    <script src="/js/d3/d3-zoom.min.js?1770157528" defer></script>
    <script src="/js/mermaid/mermaid.min.js?1770157528" defer></script>
    <script>
      window.relearn.themeUseMermaid = JSON.parse("{}");
    </script>
    <script src="/js/perfect-scrollbar/perfect-scrollbar.min.js?1770157528" defer></script>
    <script src="/js/theme.js?1770157528" defer></script>
    <div id="toast-container" role="status" aria-live="polite" aria-atomic="false"></div>
  </body>
</html>
